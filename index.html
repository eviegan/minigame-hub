<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mini Game Hub</title>
<style>
  :root { color-scheme: dark; }
  html,body{height:100%;margin:0;background:#090a16;color:#eef4ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  canvas{display:block;width:100%;height:100%}

  #menu,#leaderboardOverlay,#starter{position:fixed;inset:0;display:none;place-items:center;z-index:6;background:linear-gradient(180deg,#0a0718 0%, #090a16 100%)}
  .card{width:min(560px,92%);background:#0f1226;border:1px solid #243;border-radius:16px;padding:20px;box-shadow:0 20px 60px #0007;text-align:center}
  .grid{display:grid;gap:12px;margin-top:14px}
  .primary{background:#8a5dff;color:#0a0718;font-weight:800;border:0;padding:12px 16px;border-radius:14px;cursor:pointer;font-size:18px}
  .ghost{background:#1b2040;color:#cfe1ff;border:1px solid #2b325d;padding:10px 14px;border-radius:10px;cursor:pointer;font-size:16px}

  #hud{position:fixed;right:12px;bottom:12px;background:#0008;backdrop-filter:blur(8px);padding:8px 12px;border-radius:12px;z-index:5}
  #hud button{border:0;border-radius:12px;padding:8px 12px;font-weight:700;cursor:pointer}

  .muted{color:#a9b7d8}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px 10px;border-bottom:1px solid #2b325d;text-align:left}

  .chip{position:fixed;left:50%;transform:translateX(-50%);z-index:7;pointer-events:none;display:none;
        background:#1b2040;border:1px solid #2b325d;border-radius:999px;padding:6px 12px;font-weight:800}
  #combo{top:68px}
  #mult{top:104px;background:#20351a;border-color:#2b5d33}

  #backGameBtn{position:fixed;left:12px;top:12px;z-index:7;background:#1b2040;color:#cfe1ff;border:1px solid #2b325d;
    padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;display:none}
  #errBadge{position:fixed;right:12px;top:12px;background:#4b1010;border:1px solid #7d1b1b;border-radius:10px;padding:8px 12px;display:none;z-index:9}
</style>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.90.0/dist/phaser.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <div id="hud"><button id="claim">Claim reward</button></div>
  <div id="combo" class="chip">Combo √ó2</div>
  <div id="mult" class="chip">√ó2 active</div>
  <button id="backGameBtn">‚Üê Menu</button>
  <div id="errBadge"></div>

  <!-- Menu -->
  <div id="menu">
    <div class="card">
      <h1 style="margin:0 0 6px">Mini Game Hub</h1>
      <p class="muted" style="margin:0 0 16px">Pick a game. Press <b>ESC</b> or ‚Äú‚Üê Menu‚Äù to return here.</p>
      <div class="grid">
        <button class="primary" data-mode="mole">üéØ Whack-a-Mole</button>
        <button class="primary" data-mode="catch">üß∫ Catch the Coins</button>
        <button class="primary" data-mode="wheel">üé° Spin the Wheel (3/day)</button>
        <button class="ghost" id="openLeaderboard">üèÜ Leaderboard</button>
      </div>
    </div>
  </div>

  <!-- Starter -->
  <div id="starter">
    <div class="card">
      <h2 id="startTitle" style="margin:0 0 8px">Ready?</h2>
      <p class="muted" id="startHint" style="margin:0 0 14px"></p>
      <div class="grid">
        <button class="primary" id="startBtn">Start</button>
        <button class="ghost" id="backBtn">Back</button>
      </div>
      <div id="countdown" style="font-size:56px; margin-top:14px; display:none">3</div>
    </div>
  </div>

  <!-- Leaderboard -->
  <div id="leaderboardOverlay">
    <div class="card">
      <h2 style="margin:0 0 6px">üèÜ Leaderboard</h2>
      <p class="muted" style="margin:0 0 10px">Top 5 per game (saved on your device)</p>
      <div class="grid" id="lbTabs" style="grid-template-columns:repeat(4,1fr)">
        <button class="ghost" data-lb="mole">Mole</button>
        <button class="ghost" data-lb="catch">Catch</button>
        <button class="ghost" data-lb="wheel">Wheel</button>
        <button class="ghost" data-lb="all">All</button>
      </div>
      <div id="lbTables" style="margin-top:10px;text-align:left"></div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:14px">
        <button class="ghost" id="clearLB">Clear my scores</button>
        <button class="primary" id="closeLB">Close</button>
      </div>
    </div>
  </div>

<script>
/* ============== error badge (first error only) ============== */
(() => {
  const b = document.getElementById('errBadge');
  const show = msg => { if (b.style.display !== 'block') { b.textContent = msg; b.style.display = 'block'; } };
  addEventListener('error', e => show(e.message));
  addEventListener('unhandledrejection', e => show(String(e.reason)));
})();

/* ============== tiny sound engine ============== */
const Sound = (() => {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const resume = () => ctx.state === 'suspended' && ctx.resume();
  addEventListener('pointerdown', resume, { once:true });

  function tone(freq, dur=0.12, type='sine', vol=0.18) {
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.type=type; o.frequency.value=freq; o.connect(g); g.connect(ctx.destination);
    const t=ctx.currentTime; g.gain.setValueAtTime(0,t);
    g.gain.linearRampToValueAtTime(vol,t+.01); g.gain.exponentialRampToValueAtTime(0.0001,t+dur);
    o.start(t); o.stop(t+dur+.02);
  }
  function noise(d=0.25,v=.3){
    const n=ctx.sampleRate*d, buf=ctx.createBuffer(1,n,ctx.sampleRate), ch=buf.getChannelData(0);
    for(let i=0;i<n;i++) ch[i]=(Math.random()*2-1)*(1-i/n);
    const s=ctx.createBufferSource(); s.buffer=buf;
    const g=ctx.createGain(); g.gain.value=v; s.connect(g); g.connect(ctx.destination); s.start();
  }
  return { pop:()=>tone(1200,.08,'triangle',.16), click:()=>tone(880,.05,'square',.1),
           ding:()=>[660,990,1320].forEach((f,i)=>tone(f,.12-.02*i,'sine',.16)),
           boom:()=>{ noise(.22,.35); tone(90,.2,'sine',.12); } };
})();

/* ============== helpers & settings ============== */
const W=()=>innerWidth, H=()=>innerHeight;
const SETTINGS = {
  rewardThreshold:{ mole:14, catch:16 },
  mole:{ duration:25, gridSmall:3, gridLarge:4, popEvery:620, upTime:780 },
  wheelDailyLimit:3
};

const comboChip=document.getElementById('combo'), multChip=document.getElementById('mult');
const showCombo=m=>{comboChip.textContent=`Combo √ó${m}`;comboChip.style.display='block'};
const hideCombo=()=>comboChip.style.display='none';
const showMult=s=>{multChip.textContent=`√ó2 active (${s}s)`;multChip.style.display='block'};
const hideMult=()=>multChip.style.display='none';

function toast(scene,msg){
  const t=scene.add.text(scene.scale.width/2,scene.scale.height*.85,msg,
    {fontSize:'22px',color:'#fff',backgroundColor:'#0008',padding:{x:12,y:8}}).setOrigin(.5);
  scene.tweens.add({targets:t,alpha:0,duration:1200,delay:800,onComplete:()=>t.destroy()});
}
function saveScore(game,value){
  try{
    const key=`lb_${game}`;
    const list=JSON.parse(localStorage.getItem(key)||"[]");
    list.push({score:value,ts:Date.now()}); list.sort((a,b)=>b.score-a.score);
    localStorage.setItem(key,JSON.stringify(list.slice(0,5)));
    const bestKey=`best_${game}`, best=Math.max(value, +(localStorage.getItem(bestKey)||0));
    localStorage.setItem(bestKey,best);
  }catch{}
}
const getScores=g=>{try{return JSON.parse(localStorage.getItem(`lb_${g}`)||"[]")}catch{return[]}};
const getBest=g=>+localStorage.getItem(`best_${g}`)||0;

function makeRectTexture(s,k,w,h,fill,stroke=0xffffff){
  if(s.textures.exists(k)) return;
  const g=s.add.graphics();
  g.fillStyle(fill,1).fillRoundedRect(0,0,w,h,6);
  g.lineStyle(2,stroke,1).strokeRoundedRect(0,0,w,h,6);
  g.generateTexture(k,w,h); g.destroy();
}
function makeEmojiTexture(s,k,emoji,size=48){
  if(s.textures.exists(k)) return;
  const c=document.createElement('canvas'); c.width=c.height=size;
  const x=c.getContext('2d'); x.textAlign='center'; x.textBaseline='middle';
  x.font=`${Math.floor(size*.9)}px "Apple Color Emoji","Segoe UI Emoji",sans-serif`;
  x.fillText(emoji,size/2,size/2);
  s.textures.addCanvas(k,c);          /* <= Phaser v3 API */
}

/* ============== Whack-a-Mole (safe tweens) ============== */
class MoleScene extends Phaser.Scene{
  constructor(){ super('mole'); this.score=0; this.tl=SETTINGS.mole.duration; this.holes=[]; this.combo=0; this.ct=null; }
  create(){
    const {width:w,height:h}=this.scale; this.cameras.main.setBackgroundColor('#0a0718');
    this.add.text(w/2,28,'üéØ Whack-a-Mole',{fontSize:'24px',color:'#fff'}).setOrigin(.5);
    this.sc=this.add.text(20,16,'0',{fontSize:'20px',color:'#8EFF98'});
    this.tm=this.add.text(w-20,16,this.tl+'s',{fontSize:'20px',color:'#ffd86a'}).setOrigin(1,0);

    ['emoji_hamster','emoji_cat','emoji_dog','emoji_rabbit'].forEach((k,i)=>makeEmojiTexture(this,k,['üêπ','üê±','üê∂','üê∞'][i],64));
    makeEmojiTexture(this,'emoji_bomb','üí£',64);
    makeRectTexture(this,'holePlate',96,28,0x1b2040,0x2b325d);

    const cols=(Math.min(w,h)<720)?SETTINGS.mole.gridSmall:SETTINGS.mole.gridLarge;
    const rows=cols, gridW=Math.min(w*.9,h*.78), cell=gridW/cols, sx=w/2-gridW/2+cell/2, sy=h*.2+cell/2;
    const animals=['emoji_hamster','emoji_cat','emoji_dog','emoji_rabbit'];

    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const x=sx+c*cell, y=sy+r*cell;
        const plate=this.add.image(x,y+20,'holePlate');
        const face=this.add.image(x,y,'emoji_hamster').setVisible(false).setScale(1).setInteractive({useHandCursor:true});
        face.on('pointerdown',()=>{
          if(!face.visible) return;
          const bomb = face.getData('type')==='bomb';
          face.setScale(0.9);
          this.time.delayedCall(90,()=>{ if(face.visible) face.setScale(1); });
          if(bomb){ this.cameras.main.shake(120,.003); Sound.boom(); this.score=Math.max(0,this.score-2); this.resetCombo(); hideCombo(); }
          else    { const m=this.bump(); Sound.pop(); this.score+=m; showCombo(m); }
          face.setVisible(false); this.sc.setText(this.score);
        });
        this.holes.push({plate,face});
      }
    }

    this.pop=this.time.addEvent({
      delay:SETTINGS.mole.popEvery, loop:true, callback:()=>{
        const free=this.holes.filter(h=>!h.face.visible); if(!free.length) return;
        const h=Phaser.Utils.Array.GetRandom(free);
        const bomb=Math.random()<.18;
        const tex=bomb?'emoji_bomb':Phaser.Utils.Array.GetRandom(['emoji_hamster','emoji_cat','emoji_dog','emoji_rabbit']);
        h.face.setTexture(tex).setData('type', bomb?'bomb':'animal').setScale(0.85).setVisible(true);
        this.time.delayedCall(100,()=>{ if(h.face.visible) h.face.setScale(1); });
        this.time.delayedCall(SETTINGS.mole.upTime,()=>{ if(h.face.visible) h.face.setVisible(false); });
      }
    });

    this.clock=this.time.addEvent({ delay:1000, loop:true, callback:()=>{ this.tl--; this.tm.setText(this.tl+'s'); if(this.tl<=0) this.end(); }});
    this.input.keyboard.on('keydown-ESC',()=>this.menu());
  }
  bump(){ if(this.ct){ this.combo=Math.min(this.combo+1,9);} else { this.combo=1; } clearTimeout(this.ct);
          this.ct=setTimeout(()=>{ this.combo=0; hideCombo(); },1500);
          return this.combo>=5?3:this.combo>=3?2:1; }
  resetCombo(){ this.combo=0; clearTimeout(this.ct); this.ct=null; }
  end(){ this.pop?.remove(); this.clock?.remove(); this.resetCombo(); hideCombo();
        this.scene.pause(); saveScore('mole',this.score);
        const {width:w,height:h}=this.scale, box=this.add.rectangle(w/2,h/2,w*.84,170,0x000000,.7),
              t=this.add.text(w/2,h/2,`Time!\nScore: ${this.score}\nClick to return`,{fontSize:'22px',color:'#fff',align:'center'}).setOrigin(.5);
        [box,t].forEach(e=>e.setInteractive({useHandCursor:true}).on('pointerdown',()=>this.menu())); }
  menu(){ this.scene.stop(); showMenu(); }
}

/* ============== Catch the Coins (coins/bombs/multiplier) ============== */
class CatchScene extends Phaser.Scene{
  constructor(){ super('catch'); this.score=0; this.tl=25; this.combo=0; this.ct=null; this.mult=1; this.mTimer=null; }
  create(){
    const {width:w,height:h}=this.scale; this.cameras.main.setBackgroundColor('#0a0718');
    this.add.text(w/2,28,'üß∫ Catch the Coins',{fontSize:'24px',color:'#fff'}).setOrigin(.5);
    this.sc=this.add.text(20,16,'Score: 0',{fontSize:'20px',color:'#8EFF98'});
    this.tm=this.add.text(w-20,16,this.tl+'s',{fontSize:'20px',color:'#ffd86a'}).setOrigin(1,0);

    makeEmojiTexture(this,'emoji_coin','ü™ô',52);
    makeEmojiTexture(this,'emoji_bombSmall','üß®',52);
    makeEmojiTexture(this,'emoji_star','‚ú®',52);
    makeRectTexture(this,'basketRect',180,26,0xffd86a);

    this.physics.world.setBounds(0,0,w,h);
    this.basket=this.physics.add.image(w/2,h-60,'basketRect').setImmovable(true); this.basket.body.allowGravity=false;

    this.items=this.physics.add.group({allowGravity:true, gravityY: 780});
    this.physics.add.overlap(this.basket,this.items,(_,it)=>{
      const type=it.getData('type');
      if(type==='coin'){ const m=this.bump()*this.mult; Sound.pop(); this.score+=m; showCombo(m); this.sc.setText('Score: '+this.score); }
      else if(type==='bomb'){ Sound.boom(); this.score=Math.max(0,this.score-3); this.sc.setText('Score: '+this.score); this.cameras.main.shake(120,.003); this.resetCombo(); hideCombo(); }
      else if(type==='mult'){ Sound.ding(); this.activateMult(6); }
      it.destroy();
      if(this.score>=SETTINGS.rewardThreshold.catch && getBest('catch')<SETTINGS.rewardThreshold.catch) toast(this,'üéâ Reward unlocked!');
    });

    this.spawnEvt=this.time.addEvent({delay:520,loop:true,callback:()=>this.spawn()});
    this.events.on('update',()=>this.items.children.iterate(c=>{ if(c && c.y>h+60) c.destroy(); }));
    this.input.on('pointermove',p=>{ this.basket.x=Phaser.Math.Clamp(p.x,90,w-90); this.basket.body.updateFromGameObject(); });
    this.timer=this.time.addEvent({delay:1000,loop:true,callback:()=>{ this.tl--; this.tm.setText(this.tl+'s'); if(this.tl<=0) this.end(); }});
    this.input.keyboard.on('keydown-ESC',()=>this.menu());
  }
  spawn(){
    const w=this.scale.width, r=Math.random(); let key='emoji_coin', type='coin';
    if(r<.14){ key='emoji_bombSmall'; type='bomb'; } else if(r>.84){ key='emoji_star'; type='mult'; }
    const x=Phaser.Math.Between(40,w-40); const it=this.physics.add.image(x,-30,key).setData('type',type);
    it.setVelocity(0,140).setMaxVelocity(430,1100); this.items.add(it);
    const flash=this.add.rectangle(x,0,6,30,0xffffff).setAlpha(.7); this.tweens.add({targets:flash,alpha:0,y:60,duration:320,onComplete:()=>flash.destroy()});
  }
  activateMult(s){ this.mult=2; let left=s; showMult(left); clearInterval(this.mTimer);
    this.mTimer=setInterval(()=>{ left--; if(left>0){ showMult(left);} else { clearInterval(this.mTimer); this.mult=1; hideMult(); } },1000); }
  bump(){ if(this.ct){ this.combo=Math.min(this.combo+1,9);} else { this.combo=1; } clearTimeout(this.ct);
          this.ct=setTimeout(()=>{ this.combo=0; hideCombo(); },1500);
          return this.combo>=5?3:this.combo>=3?2:1; }
  resetCombo(){ this.combo=0; clearTimeout(this.ct); this.ct=null; }
  end(){ this.spawnEvt?.remove(); this.timer?.remove(); this.resetCombo(); hideCombo(); hideMult(); clearInterval(this.mTimer); this.mult=1;
        this.scene.pause(); saveScore('catch',this.score);
        const {width:w,height:h}=this.scale, box=this.add.rectangle(w/2,h/2,w*.84,170,0x000000,.7),
              t=this.add.text(w/2,h/2,`Time!\nScore: ${this.score}\nClick to return`,{fontSize:'22px',color:'#fff',align:'center'}).setOrigin(.5);
        [box,t].forEach(e=>e.setInteractive({useHandCursor:true}).on('pointerdown',()=>this.menu())); }
  menu(){ this.scene.stop(); showMenu(); }
}

/* ============== Spin the Wheel ============== */
class WheelScene extends Phaser.Scene{
  constructor(){ super('wheel'); this.spinning=false; }
  create(){
    const {width:w,height:h}=this.scale; this.cameras.main.setBackgroundColor('#0a0718');
    this.add.text(w/2,28,'üé° Spin the Wheel',{fontSize:'24px',color:'#fff'}).setOrigin(.5);
    this.lim=this.add.text(w/2,56,'',{fontSize:'16px',color:'#a9b7d8'}).setOrigin(.5); this.upd();

    const R=Math.min(w,h)*.28, prizes=['+10','+20','+30','+50','Try again','x2','+15','Jackpot'], seg=(Math.PI*2)/prizes.length;
    const g=this.add.graphics({x:0,y:0});
    for(let i=0;i<prizes.length;i++){ g.fillStyle(i%2?0x8a5dff:0x56d0ff,1); g.slice(R+5,R+5,R,i*seg,(i+1)*seg,false).fillPath(); }
    g.lineStyle(6,0xffffff).strokeCircle(R+5,R+5,R); const key='wheelTex'; g.generateTexture(key,R*2+10,R*2+10); g.destroy();

    this.wheel=this.add.image(w/2,h/2,key).setInteractive({useHandCursor:true});
    this.wheel.on('pointerdown',()=>this.spin(prizes));
    prizes.forEach((p,i)=>{const a=i*seg+seg/2-Math.PI/2,x=w/2+Math.cos(a)*(R*.65),y=h/2+Math.sin(a)*(R*.65); this.add.text(x,y,p,{fontSize:'18px',color:'#0a0718'}).setOrigin(.5);});
    this.add.triangle(w/2,h/2-R-18,0,18,18,18,9,0,0xffd86a).setStrokeStyle(2,0xffffff);
    this.input.keyboard.on('keydown-ESC',()=>this.menu());
  }
  key(){ return 'wheel_'+new Date().toISOString().slice(0,10); }
  used(){ return +localStorage.getItem(this.key())||0; }
  upd(){ const left=Math.max(0,SETTINGS.wheelDailyLimit-this.used()); this.lim?.setText(`Spins left today: ${left}/${SETTINGS.wheelDailyLimit}`); }
  spin(prizes){
    if(this.spinning) return;
    if(this.used()>=SETTINGS.wheelDailyLimit){ toast(this,'Limit reached. Come back tomorrow!'); return; }
    this.spinning=true; Sound.click();
    const seg=360/prizes.length, t=Phaser.Math.Between(0,prizes.length-1), angle=360*4+(t*seg)+seg/2;
    this.tweens.add({targets:this.wheel,angle,duration:3200,ease:'Cubic.easeOut',onComplete:()=>{
      this.spinning=false; localStorage.setItem(this.key(), this.used()+1); this.upd();
      const prize=prizes[t]; toast(this,`You got: ${prize}`); Sound.ding();
      saveScore('wheel',['+10','+15','+20','+30','+50','x2','Jackpot'].indexOf(prize)+1);
    }});
  }
  menu(){ this.scene.stop(); showMenu(); }
}

/* ============== boot & UI ============== */
const game=new Phaser.Game({
  type:Phaser.AUTO, backgroundColor:'#090a16',
  scale:{mode:Phaser.Scale.RESIZE,autoCenter:Phaser.Scale.CENTER_BOTH,width:W(),height:H()},
  physics:{default:'arcade',arcade:{debug:false}},
  scene:[MoleScene,CatchScene,WheelScene]
});

const menu=document.getElementById('menu');
const starter=document.getElementById('starter');
const backBtn=document.getElementById('backBtn');
const startBtn=document.getElementById('startBtn');
const startTitle=document.getElementById('startTitle');
const startHint=document.getElementById('startHint');
const cd=document.getElementById('countdown');
const backGameBtn=document.getElementById('backGameBtn');

function stopAll(){ game.scene.getScenes(true).forEach(s=>game.scene.stop(s.scene.key)); }
function showMenu(){ hideCombo(); hideMult(); menu.style.display='grid'; starter.style.display='none'; backGameBtn.style.display='none'; }
function hideMenu(){ menu.style.display='none'; }
showMenu();

let pending=null;
function openStarter(mode){
  pending=mode;
  startTitle.textContent = mode==='mole' ? 'Whack-a-Mole' : mode==='catch' ? 'Catch the Coins' : 'Spin the Wheel';
  startHint.textContent  = mode==='mole' ? 'Tap animals to score. Avoid bombs!' :
                           mode==='catch' ? 'Move basket to catch ü™ô; avoid üß®; grab ‚ú® for √ó2!' : 'Tap the wheel to spin.';
  starter.style.display='grid'; cd.style.display='none';
}
function startScene(mode){ stopAll(); game.scene.start(mode); backGameBtn.style.display='inline-block'; }

startBtn.onclick=()=>{ Sound.click(); cd.style.display='block'; let n=3; cd.textContent=n;
  const tick=()=>{ n--; if(n>0){ cd.textContent=n; setTimeout(tick,700); } else { starter.style.display='none'; startScene(pending); } };
  setTimeout(tick,700);
};
backBtn.onclick = ()=>{ Sound.click(); starter.style.display='none'; showMenu(); };
document.querySelectorAll('#menu [data-mode]').forEach(b=>b.addEventListener('click',()=>{ hideMenu(); openStarter(b.dataset.mode); }));
backGameBtn.onclick=()=>{ Sound.click(); stopAll(); showMenu(); };

document.getElementById('claim').onclick=()=>{ const s=game.scene.getScenes(true)[0]; if(s) toast(s,'Reward claimed!'); };
addEventListener('resize',()=>game.scale.resize(W(),H()));

/* leaderboard overlay */
const lb=document.getElementById('leaderboardOverlay'), lbTables=document.getElementById('lbTables');
document.getElementById('openLeaderboard').onclick=()=>{ renderLB('all'); lb.style.display='grid'; };
document.getElementById('closeLB').onclick=()=>{ lb.style.display='none'; };
document.getElementById('clearLB').onclick=()=>{ ['mole','catch','wheel'].forEach(g=>{localStorage.removeItem(`lb_${g}`);localStorage.removeItem(`best_${g}`)}); renderLB('all'); };
document.querySelectorAll('#lbTabs [data-lb]').forEach(b=>b.onclick=()=>renderLB(b.dataset.lb));
function renderLB(which){
  const gs=which==='all'?['mole','catch','wheel']:[which];
  lbTables.innerHTML=gs.map(g=>{
    const rows=getScores(g), best=getBest(g);
    const body=rows.length?rows.map((r,i)=>`<tr><td>${i+1}</td><td>${r.score}</td><td class="muted">${new Date(r.ts).toLocaleString()}</td></tr>`).join('')
                          :`<tr><td colspan="3" class="muted">No scores yet</td></tr>`;
    return `<h3 style="margin:14px 0 6px">${g.toUpperCase()} ‚Äî Best: ${best}</h3>
            <table><thead><tr><th>#</th><th>Score</th><th>When</th></tr></thead><tbody>${body}</tbody></table>`;
  }).join('');
}

</script>
</body>
</html>
